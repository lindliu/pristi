#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
Created on Mon Jun  2 13:50:44 2025

@author: dliu
"""

import plotly.express as px
import pandas as pd
import numpy as np




def share(bb, a):
    for b in bb:
        c = 0
        for i in b:
            if i in a:
                c+=1
        
        print(c)
        
        
        
df = pd.read_csv("./data/pm25/SampleData/pm25_latlng.txt")
df = df[['latitude', 'longitude']]



# # correlation cluster
# # [2, 2, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 3, 2, 2, 2, 2, 4, 2, 3, 3, 3, 3]
# color_list = np.arange(36)
# color_list[[2,  3,  4,  5,  6,  7,  8,  9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21]] = 0
# color_list[[0,  1, 22, 23, 24, 26, 27, 28, 29, 31]] = 1
# color_list[[25, 30, 32, 33, 34, 35]] = 2


# # vae error corr cluster
# # [2, 2, 2, 1, 1, 1, 2, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 3, 1, 3, 1, 2, 2, 2, 2, 2, 2, 2, 2, 4, 4, 2, 3, 3, 3]
# color_list = np.arange(36)
# color_list[[17, 21, 19, 16, 15, 14, 13, 12, 10, 11,  8,  7,  5,  4,  3,  9]] = 0
# color_list[[26, 30, 29, 28, 31, 27, 32, 25,  0, 23, 22,  6,  2,  1, 24]] = 1
# color_list[[20, 18, 34, 33, 35]] = 2


# vae latent mean cluster
# [1, 2, 1, 1, 3, 1, 1, 1, 1, 1, 3, 1, 1, 1, 1, 1, 3, 3, 3, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3]
color_list = np.arange(36)
color_list[[0, 22, 21, 20, 19, 15, 13, 12, 11, 14,  8,  7,  6,  5,  9,  3,  2]] = 0
color_list[[32, 26, 25, 24, 23, 28, 29, 30, 31, 27,  1]] = 1
color_list[[33, 17, 34, 16, 10,  4, 18, 35]] = 2


# # vae latent correlation cluster
# # [2, 4, 4, 1, 1, 4, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 3, 3, 3, 1, 1, 1, 2, 2, 4, 2, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3]
# color_list = np.arange(36)
# color_list[[13, 15, 14, 21, 12, 11, 10,  9,  8,  7,  6,  4,  3, 20, 19]] = 0
# color_list[[22, 23, 27,  0, 29, 30, 25, 31, 32, 28, 26]] = 1
# color_list[[33, 17, 18, 34, 16, 35]] = 2
# color_list[[5,  2,  1, 24]] = 3



df['color'] = color_list
df['size'] = 1

df['color'] = df['color'].astype(str)
# Plot using scatter_map
fig = px.scatter_map(
    df,
    lat="latitude",
    lon="longitude",
    color="color",
    # color_continuous_scale="Viridis",
    color_discrete_map={'0': 'orange', '1': 'red', '2': 'blue', '3':'brown', '4':'purple', '5':'green', '6':'gray'},
    size="size",
    size_max=15,
    zoom=8.6,
    height=800,
    width=800
)

# Use satellite basemap from MapLibre
# fig.update_traces(marker=dict(size=15))
fig.update_traces(marker=dict(opacity=0.5))
fig.update_layout(mapbox_style="satellite")  # now works without a token
fig.update_layout(margin={"r": 0, "t": 0, "l": 0, "b": 0})
fig.update_coloraxes(showscale=False)
fig.update_layout(showlegend=False)
fig.show()



# # Save as HTML
# fig.write_html("scatter_map_pms25.html")

# Save as PNG (requires kaleido)
# fig.write_image("scatter_map_pms25.png")
fig.write_image("scatter_map_pms25_latent_mean.png")









df = pd.read_csv("./data/metr_la/sensor_locations_la.csv")
df = df[['latitude', 'longitude']]


# # correlation cluster
# # [5,5,3,2,1,2,2,5,3,3,4,5,1,5,3,1,2,2,4,2,5,4,5,1,2,1,2,5,3,3,5,4,5,2,2,4,5,5,1,5,3,1,2,2,4,4,5,1,1,5,4,5,1,5,2,5,1,2,5,3,1,2,5,1,3,5,5,5,3,2,3,5,2,1,2,2,1,3,3,3,2,1,1,3,3,5,2,1,3,2,4,1,5,2,2,1,1,2,3,4,1,2,3,3,2,4,4,5,5,5,5,2,2,2,4,2,2,2,5,2,1,4,3,5,2,1,4,1,2,5,2,2,3,1,2,5,2,2,2,1,2,1,2,5,1,2,2,5,1,2,1,3,4,4,2,1,4,2,2,1,1,2,2,1,2,1,2,4,5,5,1,5,2,5,1,2,3,5,4,4,2,2,2,3,5,3,2,1,2,4,2,1,2,1,5,2,2,2,2,2,4,5,5,4,1,2,1]
# color_list = np.arange(207)
# color_list[[206,  91, 174,  87,  38, 170,  41, 165, 139, 163,  47,  48,  82,
#         81, 160,  52, 159,  56, 141, 155,  60,  76,  63, 150,  73, 148,
#         133,  95, 144, 191,  12, 127,  96,  15, 120, 193, 187, 100, 125,
#           4,  25, 204,  23]] = 0
# color_list[[75, 113, 111, 142,  74, 124, 140,  80, 119,
#         115, 112,  94, 104, 205, 130, 138, 137, 101,  86, 131, 136,  72,
#         134,  97,  93, 128,  89, 157,  69, 145,  26,  24, 186, 188,  19,
#         190,  17, 181,  16, 195, 196, 197, 198,   6,   5,   3, 199, 192,
#         180, 182,  33, 146, 149, 154,  61, 116,  57, 158,  54, 162, 161,
#           43,  42, 166, 172, 175,  34, 164, 117]] = 1
# color_list[[176, 122, 132, 185, 151,
#         183, 103,  64,  84,   9,  88,   8,  14,  78,  98,  77, 102,   2,
#           28,  59,  40,  70,  29,  68,  83,  79]] = 2
# color_list[[189, 153, 152, 114,  50,
#           45,  44, 167,  31, 179, 178,  21, 156,  35, 105,  10,  90, 121,
#           203,  99,  18, 106, 126, 200]] = 3
# color_list[[177,   1,  30, 202, 201,  13,  27,
#           22,   7,  20, 194,  32, 184,  11,  49, 173, 110, 109, 123, 108,
#           107, 129,  92, 135,  85, 143,  71, 147,  67,  66,  65,  62,  58,
#           55,  53,  51, 118,  46, 168, 169,  39, 171,  37,  36,   0]] = 4



# # vae error corr cluster
# # [2,1,1,4,4,4,1,1,2,1,1,2,2,4,4,4,2,4,4,1,1,4,3,4,1,2,2,1,1,4,2,1,2,4,4,4,2,3,3,3,1,4,4,4,1,1,2,4,4,4,4,2,4,4,1,1,2,1,4,1,4,4,2,4,4,4,2,4,1,4,1,2,4,4,1,4,4,2,1,1,1,4,4,1,1,1,4,4,4,1,4,1,4,1,1,2,3,4,1,1,4,4,1,1,4,2,2,2,2,2,1,1,4,4,3,4,4,4,4,1,2,4,1,1,4,2,4,3,2,2,4,4,2,4,4,1,1,4,2,2,2,4,1,2,4,1,4,4,4,4,4,4,1,1,1,4,1,1,4,4,2,1,1,2,4,4,2,1,1,1,4,1,4,1,2,1,1,1,1,4,2,2,1,4,1,2,4,2,4,4,4,4,4,4,2,4,2,4,4,4,4,1,1,1,1,4,4]
# color_list = np.arange(207)
# color_list[[103,  59, 135,  57, 136,  55,  54, 142, 145, 152, 153,  93,  44,
#        154, 156, 157, 123,  40, 122,  68,  89,  94,  98,  85,  84,  83,
#         99, 102,  80,  79,  78,  74, 110,  70, 111, 119, 161,  45,  19,
#        178,  20, 162, 182, 184,  10,   9, 201,   7,   6, 202, 203, 204,
#          2,   1, 177, 176,  91, 175,  27,  28, 173,  31, 169, 171, 167,
#        168,  24]] = 0
# color_list[[107,  95, 166, 160, 196, 105, 106, 194, 109, 138, 139, 132, 129,
#        128, 125, 108, 140, 120, 181, 174, 143, 185, 187, 180, 163,   0,
#         46,  25,  26,  16,  66,  30,  56,  32,  51,  12,  77,  71,  11,
#          8,  36,  62]] = 1
# color_list[[37, 127,  38,  22, 114,  39,  96]] = 2
# color_list[[23,  42,  41,  29,  35, 172, 165, 170, 164,  33,  34, 158, 159,
#         90, 179,   3,   4,   5, 200, 199, 198, 197, 195, 193, 192, 191,
#        190, 189, 188,  13, 186,  14,  15, 183,  17, 155,  21,  18, 149,
#         47,  67, 118, 117, 116, 115, 113, 112,  69,  72,  73, 121,  75,
#        104, 205,  81, 101, 100,  82,  86,  97,  87,  88,  76,  65,  64,
#        124, 151, 150,  92, 148, 147, 146,  48, 144,  49,  50, 141,  52,
#         53, 137,  58, 134, 133,  60, 131, 130,  61, 126,  63,  43, 206]] = 3



# vae latent mean cluster
# [3,1,1,2,4,2,3,3,3,3,3,3,4,1,2,4,5,3,2,3,1,3,4,2,1,2,2,3,1,4,3,1,1,3,1,3,3,3,4,2,1,2,3,2,1,1,3,2,4,3,3,4,3,2,3,3,5,2,3,3,2,2,3,2,1,1,1,1,1,3,2,3,3,2,1,4,2,2,1,1,1,4,2,3,2,1,3,3,3,1,1,5,1,3,3,2,3,1,2,1,2,2,2,3,1,3,3,1,1,2,1,3,2,3,3,3,1,1,1,1,3,3,1,1,2,2,3,2,3,3,3,2,1,2,3,1,1,2,3,2,2,3,3,3,4,1,2,3,2,3,2,2,3,1,2,2,2,3,2,2,4,1,1,2,2,2,3,1,1,1,2,1,2,1,4,3,1,1,1,2,2,2,1,1,1,1,3,4,1,3,3,4,3,4,2,1,5,4,1,2,1,1,3,1,3,1,2]
color_list = np.arange(207)
color_list[[67,  79,  78,  74, 161, 162,  68, 136,  66,  65,  64, 167, 168,
        169, 171, 173, 176,  45,  80,  44,  85,  90, 132, 123, 122, 119,
        118, 117, 116, 145, 110, 108, 107, 104, 205,  99,  97,  92, 153,
        89, 177, 135,  40,  20, 188,  13,  24, 195, 198, 185,  28, 184,
        183, 200, 201, 203,  31, 178, 182,  34,   2,  32,   1]] = 4
color_list[[3, 102, 101, 100,  98, 194, 150,  95, 133,  14, 131, 148, 139,
        199, 109, 127, 140, 125, 124, 151, 112, 146,   5, 137,  18, 154,
        164,  63,  41,  61,  60, 165,  57,  53, 170, 181, 172, 180,  47,
        179,  39,  43, 163,  70, 206,  25,  84,  26, 156,  23, 158,  82,
        76, 159,  73, 155,  77]] = 0## 23
color_list[[192, 138, 175, 190, 152, 141, 186, 142, 204, 166, 202, 143, 147,
        149, 157, 189,   0, 130,  58,  55,  54,  52, 134,  50,  49,  46,
        42,  37,  36,  59,  35,  30,  27,  21,  19,  17,  11,  10,   9,
          8,   7,   6,  33,  62, 103,  71, 129, 128, 126, 121, 120, 115,
        114, 113,  69, 106, 105,  96,  94, 111,  88,  72,  83,  87,  86,
        93]] = 1 ##26
color_list[[38,   4, 160,  75,  81, 197,  12,  15, 193, 191, 144, 187,  22,
        174,  29,  48,  51]] = 2
color_list[[196,  56,  91,  16]] = 3

        
# # vae latent correlation cluster
# # [1,1,1,2,2,2,1,1,1,1,1,1,2,1,2,2,3,2,2,1,1,2,3,2,1,2,2,1,1,3,1,1,1,1,1,1,1,1,2,1,1,2,1,2,1,1,1,2,2,1,2,2,2,2,1,1,3,1,1,1,2,2,2,2,1,1,1,1,1,2,1,1,2,2,1,3,2,2,1,1,1,2,2,1,2,1,1,1,1,1,1,3,1,1,1,2,2,1,2,1,2,2,2,1,1,2,1,1,1,2,1,1,2,2,1,1,1,1,1,1,2,2,1,1,2,2,2,2,1,1,2,2,1,2,2,1,1,2,1,2,2,2,1,2,3,1,2,1,2,1,2,2,1,1,1,2,2,1,2,2,2,1,1,2,2,2,2,1,1,1,2,1,2,1,2,1,1,1,1,2,2,2,1,1,1,1,1,2,1,1,1,2,2,2,2,1,3,3,1,2,1,1,1,1,1,1,2]
# color_list = np.arange(207)
# color_list[[0, 108, 110, 111, 114, 115, 116, 107, 117, 119, 122, 123, 128,
#        129, 132, 118, 135, 106, 205,  79,  80,  83,  85,  86,  87, 104,
#         88,  90,  92,  93,  94,  97,  99,  89, 136, 138, 142, 183, 184,
#        185, 186, 188, 189, 182, 190, 198, 200, 201, 202, 203, 204, 195,
#        178, 177, 176, 145, 147, 149, 152, 153, 154, 157, 161, 162, 167,
#        168, 169, 171, 173, 175,  78,  74, 103,  49,  13,  55,  54,  19,
#         20,  46,  45,  44,  42,  24,  40,  39,  37,  36,  35,  27,  34,
#         28,  30,  33,  32,  11,  10,  31,   9,  66,  57,  65,  64,   7,
#         67,  68,  70,   6,  59,  71,   8,   2,   1,  58]] = 0
# color_list[[151, 163,  25,  26, 155, 160, 159, 199,   5,   4, 156,   3, 158,
#         23, 165, 187,  12, 191,  14,  15, 181, 180, 179,  17, 150,  18,
#        192, 174, 193, 194, 172,  21, 170, 166, 164,  73, 139, 146, 148,
#        109,  51,  52,  53, 105, 102, 101, 100,  98,  50,  96,  60,  61,
#         62,  63,  84,  82,  81,  69,  77,  76,  95, 112, 206,  48, 143,
#        141, 140,  72, 137, 134, 133, 113, 131, 130,  38, 126, 125, 124,
#         41, 127, 121, 120,  43,  47]] = 1
# color_list[[56,  75, 144,  29, 197,  22,  91, 196,  16]] = 2



df['color'] = color_list
df['size'] = 1


df['color'] = df['color'].astype(str)
# Plot using scatter_map
fig = px.scatter_map(
    df,
    lat="latitude",
    lon="longitude",
    color="color",
    # color_continuous_scale="Viridis",
    color_discrete_map={'0': 'orange', '1': 'red', '2': 'blue', '3':'brown', '4':'purple', '5':'green', '6':'gray'},
    size="size",
    size_max=10,
    zoom=10.5,
    height=800,
    width=800
)

# Use satellite basemap from MapLibre
fig.update_traces(marker=dict(opacity=0.5))
fig.update_layout(mapbox_style="satellite")  # now works without a token
fig.update_layout(margin={"r": 0, "t": 0, "l": 0, "b": 0})
fig.update_coloraxes(showscale=False)
fig.update_layout(showlegend=False)
fig.show()



# # Save as HTML
# fig.write_html("scatter_map_pms25.html")

# Save as PNG (requires kaleido)
# fig.write_image("scatter_map_metrla.png")
fig.write_image("scatter_map_metrla_latent_mean.png")







df = pd.read_csv("../../data/pems_bay/sensor_locations_bay.csv", names=['id','latitude','longitude'])
df = df[['latitude', 'longitude']]


# # correlation cluster
# # [1,3,2,3,1,1,2,3,3,3,3,3,3,2,1,3,2,3,3,1,2,1,3,1,3,1,3,1,1,1,1,3,3,3,1,1,1,3,2,2,1,3,3,2,1,1,3,1,3,3,3,3,1,2,1,3,3,1,1,1,3,3,1,2,1,3,1,1,2,1,1,1,3,3,3,3,3,1,1,3,2,3,3,3,3,3,1,1,1,1,1,3,1,1,1,3,3,3,1,1,1,3,3,3,1,1,3,1,3,3,1,2,1,3,3,3,3,2,1,3,3,3,3,3,1,1,3,3,1,1,1,1,1,3,3,3,3,1,1,1,2,3,1,1,3,3,2,3,2,1,1,3,3,2,2,3,1,1,1,1,1,1,1,3,2,1,1,3,1,3,2,1,1,3,1,3,3,2,3,3,2,1,3,2,1,2,1,1,1,1,1,3,3,1,1,3,3,3,1,2,3,3,1,3,1,3,2,2,3,2,2,1,2,1,1,2,1,3,1,3,1,3,1,3,1,3,3,3,1,3,1,3,3,3,3,3,3,1,1,1,3,1,2,1,3,3,1,1,3,3,1,2,3,1,3,1,3,1,1,1,1,1,1,1,1,2,2,2,1,1,1,1,1,1,3,3,3,3,3,3,1,3,3,3,3,3,1,1,1,1,1,1,1,1,1,1,1,1,1,3,3,3,3,3,3,3,3,3,3,3,1,3,1,2,1,1,1,3,3,2,1,1,1,1,1]
# color_list = np.arange(325)
# color_list[[0,   4,   5,  14,  19,  21,  23,  25,  27,  28,  29,  30,  34,
#         35,  36,  40,  44,  45,  47,  52,  54,  57,  58,  59,  62,  64,
#         66,  67,  69,  70,  71,  77,  78,  86,  87,  88,  89,  90,  92,
#         93,  94,  98,  99, 100, 104, 105, 107, 110, 112, 118, 124, 125,
#         128, 129, 130, 131, 132, 137, 138, 139, 142, 143, 149, 150, 156,
#         157, 158, 159, 160, 161, 162, 165, 166, 168, 171, 172, 174, 181,
#         184, 186, 187, 188, 189, 190, 193, 194, 198, 202, 204, 211, 213,
#         214, 216, 218, 220, 222, 224, 228, 230, 237, 238, 239, 241, 243,
#         246, 247, 250, 253, 255, 257, 258, 259, 260, 261, 262, 263, 264,
#         268, 269, 270, 271, 272, 273, 280, 286, 287, 288, 289, 290, 291,
#         292, 293, 294, 295, 296, 297, 298, 310, 312, 314, 315, 316, 320,
#         321, 322, 323, 324]] = 0
# color_list[[2,   6,  13,  16,  20,  38,  39,  43,  53,  63,  68,  80, 111,
#         117, 140, 146, 148, 153, 154, 164, 170, 177, 180, 183, 185, 199,
#         206, 207, 209, 210, 212, 215, 242, 251, 265, 266, 267, 313, 319]] = 1
# color_list[[1,   3,   7,   8,   9,  10,  11,  12,  15,  17,  18,  22,  24,
#         26,  31,  32,  33,  37,  41,  42,  46,  48,  49,  50,  51,  55,
#         56,  60,  61,  65,  72,  73,  74,  75,  76,  79,  81,  82,  83,
#         84,  85,  91,  95,  96,  97, 101, 102, 103, 106, 108, 109, 113,
#         114, 115, 116, 119, 120, 121, 122, 123, 126, 127, 133, 134, 135,
#         136, 141, 144, 145, 147, 151, 152, 155, 163, 167, 169, 173, 175,
#         176, 178, 179, 182, 191, 192, 195, 196, 197, 200, 201, 203, 205,
#         208, 217, 219, 221, 223, 225, 226, 227, 229, 231, 232, 233, 234,
#         235, 236, 240, 244, 245, 248, 249, 252, 254, 256, 274, 275, 276,
#         277, 278, 279, 281, 282, 283, 284, 285, 299, 300, 301, 302, 303,
#         304, 305, 306, 307, 308, 309, 311, 317, 318]] = 2



# # vae error corr cluster
# # [1,3,2,3,2,1,3,3,3,3,2,3,5,2,1,3,5,3,5,2,3,1,5,2,2,1,2,1,1,1,1,3,3,3,1,1,1,3,3,2,1,3,3,3,1,1,2,1,3,3,2,3,1,2,1,3,3,1,1,1,3,3,1,2,2,5,1,1,2,1,1,1,3,3,5,3,4,1,1,3,3,3,2,3,3,3,2,1,2,2,1,3,1,1,1,2,3,3,1,1,2,3,3,3,1,1,3,1,3,3,1,3,1,3,3,2,3,5,1,3,3,2,3,3,1,5,3,3,1,1,2,1,1,4,2,3,2,1,2,1,2,3,1,1,3,3,4,3,4,1,2,3,2,2,2,3,2,1,2,1,2,1,1,2,5,2,2,3,2,3,5,1,1,3,4,3,3,5,3,3,3,2,3,1,1,2,1,1,1,1,1,3,3,1,1,3,3,3,2,3,3,3,2,3,2,3,2,2,3,2,3,2,2,2,1,2,1,3,1,3,1,3,2,3,2,3,3,3,1,3,1,5,3,3,4,3,3,1,1,1,3,1,2,3,3,5,1,2,3,3,2,2,3,1,3,2,3,1,1,1,1,5,1,5,1,2,5,2,5,1,1,1,1,2,3,5,3,3,3,3,1,3,2,5,5,3,1,5,1,1,1,2,4,5,1,5,1,1,1,3,3,3,3,3,5,5,3,5,5,3,2,3,1,2,1,1,1,3,2,5,2,2,2,2,1]
# color_list = np.arange(325)
# color_list[[0, 139, 142, 143, 149, 157, 159, 161, 171, 172, 183, 184, 186,
#        187, 188, 189, 137, 190, 132, 129,  87,  90,  92,  93,  94,  98,
#         99, 104, 105, 107, 110, 112, 118, 124, 128, 131,  78, 193, 214,
#        271, 272, 280, 286, 288, 289, 290, 294, 296, 297, 298, 312, 314,
#        315, 316, 270, 194, 269, 262, 216, 218, 220, 228, 230, 237, 238,
#        239, 241, 246, 253, 257, 258, 259, 260, 264,  77, 162, 324,  67,
#         66,  40,  28,  27,  44,  52,  29,  62,  45,  47,  59,  58,  57,
#         21,  54,   5,  36,  25,  69,  34,  35,  30,  14,  71,  70]] = 0
# color_list[[160, 212, 255, 158, 156, 213,  23, 202, 153, 152, 215, 150,  50,
#         39, 265, 267, 211, 154, 323, 165, 204, 185, 224,  26, 181, 242,
#        206, 247, 207, 209, 250, 222,  46, 251, 168,  24, 198, 163, 166,
#         19,  63,  64, 140,  95,  68,   4, 115,  89, 291,  10,  88, 310,
#         86, 121, 282,  13, 313, 100, 320,  53, 136, 273, 138, 322, 134,
#         82, 130,   2, 318, 321]] = 1
# color_list[[236, 235, 311, 233,   3, 229, 223, 227, 226, 225, 317,   1, 232,
#         31,  15, 306,  17, 221,  20, 274, 276, 277, 278, 256, 279, 281,
#        285, 254,  11, 309,   9,   8,   7,   6, 249, 248, 299, 300, 244,
#        243, 301, 302, 240, 303, 252,  32, 200,  33, 114, 116,  60, 119,
#        120, 122, 123, 113, 126,  56,  55, 135, 219,  51, 144, 145, 127,
#        147,  61, 109,  73,  79,  80,  81,  83,  84,  85, 111,  72,  96,
#         97, 101, 102, 103, 106, 108,  91, 151, 141, 196, 179, 178,  43,
#         42,  41,  38, 191, 192, 176, 175,  37, 173, 195, 182, 180, 169,
#        167, 199,  75,  48, 201,  49, 203, 205, 208, 210, 155, 217, 197]] = 2
# color_list[[234, 148, 292,  76, 146, 133, 174]] = 3
# color_list[[74, 261, 263, 319,  18, 266, 268,  16, 164, 275, 231, 170, 293,
#        307, 305, 304, 125,  65, 177, 283, 284, 245,  12, 287, 295, 117,
#         22, 308]] = 4



# vae latent mean cluster
# [2,4,4,3,3,1,4,1,3,5,1,3,1,1,2,3,2,5,2,4,3,4,2,4,2,1,5,2,3,3,2,3,3,2,1,4,1,3,4,2,1,3,4,4,2,1,1,2,4,3,1,1,1,4,3,5,1,3,1,3,4,3,2,1,4,2,5,4,4,3,1,3,4,3,4,1,2,1,2,3,4,4,5,4,3,3,1,3,5,1,4,3,2,3,3,1,4,4,4,3,1,3,1,1,5,1,4,2,1,1,1,2,1,4,3,3,4,2,1,2,3,5,1,1,1,2,4,3,3,1,1,3,4,5,5,5,1,1,5,1,2,1,2,2,3,4,3,3,2,4,2,4,5,1,2,1,2,1,3,4,1,4,5,4,2,2,1,4,1,5,1,3,2,2,3,2,4,2,1,2,1,2,4,4,1,1,1,1,1,2,2,1,3,2,3,3,3,3,1,1,3,4,3,4,3,4,1,1,4,1,4,1,2,1,4,3,1,3,3,3,1,3,1,3,3,4,3,3,2,3,2,4,3,2,1,5,3,2,3,1,1,4,2,4,4,2,1,3,1,4,3,4,3,2,3,1,3,1,2,2,2,2,2,2,1,1,2,2,3,1,1,1,1,3,4,4,4,3,3,4,1,3,3,3,3,4,1,1,1,3,3,1,5,5,3,5,1,3,2,3,3,3,5,5,4,4,2,5,5,2,5,1,2,3,1,2,1,1,4,2,5,2,1,2,1]
color_list = np.arange(325)
color_list[[324,  86, 185, 186, 187, 188, 191,  77, 198,  75, 199, 206, 207,
        209,  70, 211, 213, 137, 220, 222,  63, 234,  58,  56, 184,  89,
        180, 178, 130, 129, 139, 141, 124, 123, 122, 118, 153, 155, 157,
        239, 112, 110, 109, 108, 105, 103, 102, 166, 100, 168, 170,  95,
        160, 240, 216,  52, 269, 270, 271,  25, 272, 280, 286, 287, 288,
        291, 296, 311,  13,  12,  10, 314,   7, 316,   5, 317, 322, 265,
        264, 136,  51,  34, 248, 246,  45,  36,  50, 255, 257,  46,  40]] = 0
color_list[[190, 312, 156, 228, 154, 315, 150, 148, 143, 233, 245, 142, 237,
        140, 319, 321, 230, 309, 164, 323, 189, 263, 193, 262, 266, 267,
        181, 261, 260, 306, 179, 242, 175, 173, 172, 258, 212, 253, 165,
        298, 259, 177,   0,  39,  92,  14,  33,  30, 107, 111,  27,  24,
        44, 117,  62, 119,  78,  47,  65, 125,  76,  18,  22,  16]] = 1
color_list[[226, 247,  69,  49,  54, 215, 217, 238,  57,  11, 219,  59, 232,
        61, 221, 223, 227, 224, 236, 313, 229, 252, 301, 300, 299, 297,
        294,  15, 290, 289,  20, 284, 283, 282, 250, 281, 277, 273,  28,
        268,  29,  31,  32,  37,  71,  41, 256, 254, 278,  73, 218, 204,
        79, 120,   8,  84,  85,  87, 115, 192, 114,  93, 158,  94, 174,
        171, 101,   4,  91, 147,   3, 195, 131, 202, 128, 127, 194, 144,
        200,  99, 196, 197, 146]] = 2
color_list[[1, 167, 132,  21, 318, 106, 163,   2, 161, 285, 159, 145, 126,
        19, 149, 275, 276, 151, 116, 279,  23,  35, 113, 274,  97,  98,
        38,  81,  80, 225,  64,  74, 305, 201, 214,  67,  68, 210, 203,
        208,  72,  83,  60, 231, 182,  42,  43, 205,  96, 251, 249, 176,
        183, 304,  48, 244, 243,  53, 241,  90,   6]] = 3
color_list[[9, 308, 307, 310, 320, 134, 302, 135, 138, 121, 152, 104, 169,
        88,  82,  66, 133, 235,  55,  26, 292, 293, 295,  17, 303, 162]] = 4





# # vae latent corr cluster
# # [5,2,3,3,5,1,3,1,1,3,1,1,3,1,1,1,1,3,1,5,2,1,1,6,1,4,3,4,1,4,1,4,5,4,1,6,5,3,2,1,4,2,2,6,1,1,1,4,3,3,2,4,4,2,4,2,5,6,1,1,3,3,1,1,2,1,2,6,3,6,1,1,2,3,6,1,4,1,4,5,2,1,3,2,4,1,4,1,2,1,1,1,4,1,4,1,3,5,1,6,1,2,5,4,2,4,3,5,1,5,1,1,4,1,1,6,2,1,4,1,3,3,4,1,4,4,3,1,1,1,1,1,6,2,6,3,5,1,6,1,1,5,5,1,1,2,6,1,1,6,1,2,2,1,1,4,5,4,6,2,1,2,2,3,1,4,1,2,6,3,1,6,5,4,6,4,2,1,4,4,4,1,3,6,1,1,4,6,4,4,4,1,3,5,1,3,5,1,1,1,3,3,2,6,2,2,1,2,2,1,6,1,1,1,2,2,1,5,6,3,1,2,1,2,2,2,3,3,4,3,5,3,5,5,3,3,1,4,1,1,3,2,1,6,3,1,4,2,4,2,4,2,2,5,3,4,3,5,1,1,4,1,1,1,1,4,1,4,1,1,1,1,1,2,3,3,3,3,1,3,1,1,3,3,3,2,4,1,1,1,1,2,2,2,1,6,1,1,4,3,3,2,3,3,3,3,4,3,2,4,2,5,1,2,1,4,1,1,2,4,2,5,1,5,1]
# color_list = np.arange(325)
# color_list[[324, 108, 199, 206, 100, 209,  98, 211, 212,  95, 213,  93,  91,
#         90, 198,  89, 216,  85, 220, 222,  81,  77, 236,  75, 147, 239,
#         71,  70, 242,  87, 245, 110, 197, 150, 144, 143, 153, 140, 139,
#        154, 137, 160, 164, 166, 131, 130, 111, 129, 127, 170, 123, 177,
#        181, 184, 119, 185, 117, 191, 194, 114, 113, 128,  65, 238, 148,
#        278, 280, 281,  39, 314, 287, 288,  10, 289,  11,  63,  34, 290,
#         13,  14,  30,  15,  28, 294, 296, 297,  24,  16,  22,  21, 312,
#          8,  18,  45,  62, 322, 258,  59,  58, 259, 261, 262, 263,  44,
#        317, 264,   5,  46,   7, 272, 271, 269, 270, 268, 266, 316]] = 0
# color_list[[318, 313, 161, 320, 151, 152, 167, 159, 251, 310, 249, 247, 252,
#        241, 225, 224, 223, 221, 215, 214, 273, 285, 208, 207, 205, 204,
#        291, 292, 293, 301, 308, 176, 202, 162,  42,  55,  41, 101,  88,
#         50, 104,  64,  83, 133,  66,  80,  53,  20,  72, 116,   1, 145,
#         38]] = 1
# color_list[[201, 302, 200, 303, 300, 304,  61, 106, 277,  96,  37,  73, 231,
#        240, 229, 227, 299, 226, 244, 219,  68,  26, 305, 284,  82, 195,
#        192, 307,  12, 126,   9,  49, 163,  48, 169,   6,   3, 279, 274,
#        275,   2, 276, 135, 283,  17, 235, 234, 254, 256, 282,  60, 121,
#        182, 120]] = 2
# color_list[[255,  47,  51, 267, 250, 260,  54, 265, 248, 246,  52, 286,  40,
#        237, 186, 118, 309, 180, 179, 178, 122, 124, 175, 173, 125, 165,
#        315, 157, 319, 155,  76, 188,  92, 190,  33,  31, 228,  78,  29,
#        189,  27,  84,  94,  25, 298, 103, 105, 112, 306,  86]] = 3
# color_list[[19, 311,   4,  32, 321,  36,   0,  56, 196, 109, 107, 172, 102,
#         97, 217, 323, 230, 232,  79, 136, 156, 141, 253, 257, 142, 233,
#        193]] = 4
# color_list[[134, 183, 132, 158, 168, 171, 138, 174, 203, 115,  43,  23,  99,
#        210, 295, 218,  35, 149,  74,  69, 243,  67,  57, 187, 146]] = 5

df['color'] = color_list
df['size'] = 1


df['color'] = df['color'].astype(str)
# Plot using scatter_map
fig = px.scatter_map(
    df,
    lat="latitude",
    lon="longitude",
    color="color",  # 现在是离散变量
    color_discrete_map={'0': 'orange', '1': 'red', '2': 'blue', '3':'brown', '4':'purple', '5':'green', '6':'gray'},
    size="size",
    size_max=10,
    zoom=10.5,
    height=800,
    width=800
)

# Use satellite basemap from MapLibre
fig.update_traces(marker=dict(opacity=0.5))
fig.update_layout(mapbox_style="satellite")  # now works without a token
fig.update_layout(margin={"r": 0, "t": 0, "l": 0, "b": 0})
fig.update_coloraxes(showscale=False)
fig.update_layout(showlegend=False)
fig.show()



# # Save as HTML
# fig.write_html("scatter_map_pms25.html")

# Save as PNG (requires kaleido)
# fig.write_image("scatter_map_pemsbay.png")
fig.write_image("scatter_map_pemsbay_latent_mean.png")





from PIL import Image

# 加载图片
img1 = Image.open("scatter_map_pms25_latent_mean.png")
img2 = Image.open("scatter_map_metrla_latent_mean.png")
img3 = Image.open("scatter_map_pemsbay_latent_mean.png")

padding = 10
# 获取尺寸（假设两个图片高度相同，用于水平合并）
width1, height1 = img1.size
width2, height2 = img2.size
width3, height3 = img3.size

# 创建新画布（水平合并）
new_width = width1 + width2 + width3 + 4*padding
new_height = max(height1, height2, height3)+padding*2
new_img = Image.new("RGB", (new_width, new_height), color="white")

# 粘贴图片
new_img.paste(img1, (padding, padding))
new_img.paste(img2, (width1 + 2*padding, padding))
new_img.paste(img3, (width1 + width2 + 3*padding, padding))

# 保存或者显示
new_img.save("merge_scatter_map_latent_mean.png")
new_img.show()




from PIL import Image

# 加载图片
img1 = Image.open("scatter_map_pms25.png")
img2 = Image.open("scatter_map_metrla.png")
img3 = Image.open("scatter_map_pemsbay.png")

padding = 10
# 获取尺寸（假设两个图片高度相同，用于水平合并）
width1, height1 = img1.size
width2, height2 = img2.size
width3, height3 = img3.size

# 创建新画布（水平合并）
new_width = width1 + width2 + width3 + 4*padding
new_height = max(height1, height2, height3)+padding*2
new_img = Image.new("RGB", (new_width, new_height), color="white")

# 粘贴图片
new_img.paste(img1, (padding, padding))
new_img.paste(img2, (width1 + 2*padding, padding))
new_img.paste(img3, (width1 + width2 + 3*padding, padding))

# 保存或者显示
new_img.save("merge_scatter_map.png")
new_img.show()